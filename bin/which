#!/usr/bin/env php
<?php
declare(strict_types=1);
namespace which\cli;

use EventLoop\{EventLoop};
use Rx\{Observable, Scheduler};
use Rx\Scheduler\{EventLoopScheduler};
use which\{Application};

/**
 * Application entry point.
 * @return Observable Completes when the program is terminated.
 */
function main(): Observable {
  @cli_set_process_title('Which.php');

  Scheduler::setDefaultFactory(function() {
    return new EventLoopScheduler(EventLoop::getLoop());
  });

  return (new Application)->run();
}

// Start the application.
$fileInfo = new \SplFileInfo(__DIR__.'/../../../autoload.php');
require_once $fileInfo->isFile() ? $fileInfo->getPathname() : __DIR__.'/../vendor/autoload.php';

main()->subscribe(null, function(\Throwable $e) {
  echo $e, PHP_EOL;
  exit(2);
});
